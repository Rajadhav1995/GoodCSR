{% extends 'base.html' %}
{% load common_tags %}
{% load urs_tags %}
{% block section %}
<style>
   .right {
   padding-top: 50px;
   float: right;
   width: 300px;
   border: 3px solid #73AD21;
   padding: 10px;
   }
</style>
<div> </div>
{% endblock %}
<!-- Content Header (Page header) -->
<!--<style>
   form {
   margin: 0 auto;
   width:450px;
   }
   </style>-->
<!-- Main content -->
{% block content %}
<div class="clear"></div>
<section class="content-part">
<div class='container'>
   <div class="white-box" >
      <div class="col-md-12">
         <h3 class="border_line"> {{project.name}} </h3>
         <br>
      </div>

      <form autocomplete="off" id="report" class ="form-horizantal budget_form" action="/report/section-form/" method="POST" enctype="multipart/form-data">
         {% csrf_token %}
         <div class="col-md-12">
            <h3 class="border_line">Cover Page</h3>
            <br>
            <input type="hidden" name="project_slug" value="{{project_slug}}" id="{{project_slug}}">

            <input type="hidden" name="report_id" value="{{report_id}}" id="{{report_id}}">
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Report Name</label>
                        <input type="text" name="report_name" value="{{report_obj.name}}" id="id_report_name" required="" class="form-control"></input>
                     </div>
                  </div>
               </div>
            </div>
            
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Cover Image</label>
                        <input type="file" name="upload_cover_image" id="id_cover_image" required=""></input>
                     </div>
                  </div>
               </div>
            </div>
            
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Report Type</label>
                        <div><b>{{report_obj.get_report_type_display}}</b></div>
                     </div>
                  </div>
               </div>
            </div>
            
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Duartion</label>
                        <div><b>{{report_obj.start_date|date:'Y-m-d'}}  to  {{report_obj.end_date|date:'Y-m-d'}}</b></div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Prepared By</label>
                        <div><b>{{user.name}}</b></div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Logo</label>
                        {% get_org_logo project as org_logo %}
                        {% if org_logo %}
                        {{org_logo}} {% else %}<img src="/static/img/GoodCSR_color_circle.png" alt="" title="" height='117px' width = '100px'>{% endif %}
                     </div>
                  </div>
               </div>
            </div>
            
         </div>
         
         
         <div class="col-md-12">
            <h3 class="border_line">Program Summary Sheet</h3>
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Project Title</label>
                        <div><b>{{project.name}}</b></div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Funder<font color="red">*</font></label>
                        <select class="form-control" name="funder" id="funder">
                           <option selected disabled>Select Funder</option>
                           {% for i in funder_user %}<option {% if mapping_view.funder.id == i.id %}selected="selected" {% endif %} value="{{i.organization}}" >{{i.organization}}</option>{% endfor %}
                        </select>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Project Budget</label>
                        <div><b>{{project.total_budget}}</b></div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Project Duration </label>
                        <div><b>{{project.start_date|date:'Y-m-d'}}  to  {{project.end_date|date:'Y-m-d'}}</b></div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Number of Beneficiaries</label>
                        <div><b>{{project.no_of_beneficiaries}}</b></div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Implementation partner<font color="red">*</font></label>
                        <select class="form-control" name="implementation_partner" id="implementation_partner" required>
                           <option selected disabled>Select Implementation Partner</option>
                           {% for i in partner %}<option {% if mapping_view.implementation_partner.id == i.id %}selected="selected" {% endif %} value="{{i.organization}}" >{{i.organization}}</option>{% endfor %}
                        </select>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Project Description<font color="red">*</font></label>
                        <textarea type="text" name="description" value="{{project.summary}}" id="description" required="" class="form-control text_area"></textarea>
                     </div>
                  </div>
               </div>
            </div>
            
            <div class="row">
               <div class="col-md-6 nopadding">
                  <div class="col-md-12">
                     <div class="form-group">
                        <label>Objective of the project<font color="red">*</font></label>
                        <textarea type="text" name="objective" id="objective" required="" class="form-control text_area"></textarea>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         
          <input class="btn btn-primary" name = 'quarter_updates' type="submit" value="Save and Generate Quarter Updates" onclick="return ddlValidate();" />
         <input class="btn btn-primary" name = 'report_save' type="submit" value="Save" onclick="return ddlValidate();" />
         <a class="btn btn-success" href="/project/summary/?slug={{project_slug}}&key=summary"">Back</button></a>
         </form>
   </div>

</div>


<input type="hidden" name="loop_count" id="loop_count" value="{{activity_view.count}}">

<script src="http://code.jquery.com/jquery-migrate-1.0.0.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://rawgit.com/Pixabay/jQuery-tagEditor/master/jquery.caret.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://rawgit.com/Pixabay/jQuery-tagEditor/master/jquery.tag-editor.js"></script>
<link rel="stylesheet" href="https://rawgit.com/Pixabay/jQuery-tagEditor/master/jquery.tag-editor.css">
<script>
   $(document).ready(function() {
     $("#id_start_date").datepicker({dateFormat: 'yy-mm-dd',changeMonth: true,changeYear: true });
     $("#id_end_date").datepicker({ dateFormat: 'yy-mm-dd',changeMonth: true,changeYear: true });
     var start_date = "{{project.start_date|date:'Y-m-d'}}"
     if (start_date != ''){
         document.getElementById("id_start_date").value = start_date
         $("#id_start_date").datepicker({dateFormat: 'yy-mm-dd',minDate: start_date,changeMonth: true,changeYear: true });
     }
   } );
</script>
<script type="text/javascript">
   $(document).ready(function() {
       //var loop_count = $('#loop_count').val()
       var max_fields      = 10; //maximum input boxes allowed
       var wrapper         = $(".input_fields_wrap"); //Fields wrapper
       var add_button      = $(".add_field_button"); //Add button ID

       var loop_count = $('#loop_count').val()
       var loop_count = Number(loop_count);
       if (loop_count > 0) {
           var x =Number(loop_count);
       } else {
           var x =Number(loop_count)+1
       }
       //var x =Number(loop_count)+1;
       $(add_button).click(function(e){ //on add input button click
           e.preventDefault();
           if(x < max_fields){ //max input box allowed
               x++; //text box increment
               // $(wrapper).append('<div><input type="text" name="location['+x+']"/><a href="#" class="remove_field">Remove</a></div>'); //add input box
               $(wrapper).append('<div><input class="form-control" placeholder="Enter Activity Name" type="text" name="activity['+x+']"/><input class="form-control" type="number" placeholder="Duration" name="duration['+x+']" id="id_number"><a href="#" class="remove_field">Remove</a></div>'); //add input box

               // $(wrapper).append('<div><input type="text" name="location['+x+']"/><select><option value="volvo">Volvo</option><option value="saab">Saab</option><option value="opel">Opel</option><option value="audi">Audi</option></select><a href="#" class="remove_field">Remove</a></div>'); //add input box
           }
           document.getElementById("activity_count").value = x;

       });

       $(wrapper).on("click",".remove_field", function(e){ //user click on remove text
           e.preventDefault(); $(this).parent('div').remove(); x--;
       })
   });
</script>
<style>
   .error{color:red; min-width: 200px;}
</style>
<div class="control-sidebar-bg"></div>
<script>
   $("#id_end_date").datepicker({
     dateFormat: 'yy-mm-dd',
     onSelect: function(dateText, inst) {
         var start = new Date($('#id_start_date').val());
         var end = new Date($('#id_end_date').val());
         if (end <= start) {
             alert("'End date' should be greater than 'Start date'")
             document.getElementById('dateError').innerHTML="End date should be greater than Start date"
         };
         if (end > start) {
             document.getElementById('dateError').innerHTML=""
             document.getElementById('dateError1').innerHTML=""
         };

         var months = (end.getFullYear() - start.getFullYear()) * 12;
         months += end.getMonth() - start.getMonth();
         document.getElementById("id_duration").value = months;

     }

   });
</script>
<script>
   $("#id_start_date").datepicker({
     dateFormat: 'yy-mm-dd',
     onSelect: function(dateText, inst) {
         var start = new Date($('#id_start_date').val());
         var end = new Date($('#id_end_date').val());
         end.setDate(end.getDate() + 1);
         if (end <= start) {
             alert("'End date' should be greater than 'Start date'")
             document.getElementById('dateError').innerHTML="End date should be greater than Start date"
         };
         if (end > start) {
             document.getElementById('dateError').innerHTML=""
             document.getElementById('dateError1').innerHTML=""
         };

         var months = (end.getFullYear() - start.getFullYear()) * 12;
         months += end.getMonth() - start.getMonth();
         document.getElementById("id_duration").value = months;
         var start = new Date($('#id_start_date').val());

     }

   });
</script>
<script>
   function date_validate() {
       if ($('#id_start_date').val()>$('#id_end_date').val()){
           alert("'End date' should be greater than 'Start date'");
           return false;
           } else {
               return true;
           }
       }
</script>
<script>
   function funder_val() {
       var e = document.getElementById("funder");
       var str = e.options[e.selectedIndex].value;

   }
</script>
<script type="text/javascript">
   $(document).ready(function(){
       $('select[multiple=multiple]').multiSelect()
       $("#report").validate({
           rules :
           {
               //id_project : {required:true},
               //program : {required:true},
               name : {required:true, maxlength: 300},
               total_budget : {required:true},
               no_of_beneficiaries : {required:true},
               target_beneficiaries : {required:true},
               cause_area : {required:true},
               duration : {required:true},
               funder: {required:true},
               implementation_partner: {required:true},
           },
           messages:
           {
               //id_project : {required : "<font color=#fc282f>Please enter the name</font>"},
               //program:{required:"<font color=#fc282f>Please select the program</font>"},
               name:{required:"<font color=#fc282f>Please enter name"},
               total_budget : {required:"<font color=#fc282f>Please enter Total Budget</font>"},
               no_of_beneficiaries:{required:"<font color=#fc282f>Please enter the no of beneficiaries</font>"},
               target_beneficiaries : {required : "<font color=#fc282f>Please enter primary beneficiary</font>"},
               cause_area : {required : "<font color=#fc282f>Please enter primary area of focus</font>"},
               duration : {required : "<font color=#fc282f>Please select project Start date and End date</font>"},
               funder : {required : "<font color=#fc282f>Please select funder</font>"},
               implementation_partner : {required : "<font color=#fc282f>Please select Implementation Partner</font>"},


           },
           highlight: function (element) {
               $(element).parent().addClass('error')
           },
           unhighlight: function (element) {
               $(element).parent().removeClass('error')
           },


       });

   });
</script>
{% endblock %}
