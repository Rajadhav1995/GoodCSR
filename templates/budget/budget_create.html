{% extends 'base.html' %}
{% block section %}
{% endblock %}
{% block content %}
<div class="">
    <div class="clearfix"></div>
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
				<ul class="nav navbar-right panel_toolbox">
				<div class="fa-hover col-md-3 col-sm-4 col-xs-12">
										
				</div>
				</ul>
                    <div class="x_title">
                        <h2 ><a href="/manage/project/budget/list/?slug={{project_slug}}"> Budget List</a> -> {% if key == "budget" %} Create Budget {% else %} Create SubCategory {% endif %} </h2>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                    {% if key == 'budget' %}
                        

                        <form id="ic_form" action="." method = "post" data-parsley-validate class="form-horizontal form-label-left">{% csrf_token %}
                        <input type="hidden" name="slug" value="{{project_slug}}">
                    {% if message %}<p style="color:red"><b>{{message}}</b></p>{% endif %}
                    <small>Note: Fields marked with Asterisk (<span class="required" style="color:red">*</span>) are mandatory</small></br></br>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Project <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                            <input class="form-control" type="text" name="project" value="{{projectobj.name}}" readonly />
                            </div>
                        </div>
                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Start Date <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                                {{ form.actual_start_date }}
								{{ form.actual_start_date.errors }}
                                <font color=#fc282f><b><span id="dateError1"></span></b></font>
                            </div>
                        </div>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                End Date <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                                {{ form.end_date }}
								{{ form.end_date.errors }}
                                <font color=#fc282f><b><span id="dateError"></span></b></font>
                            </div>
                        </div>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Budget Duration <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                                <input class="form-control" type="text" id="id_duration"  readonly /> 
                            </div>
                        </div>

                    {% else %}
                        <form id="ic_form" action="/manage/project/budget/category/add/?slug={{project_slug}}&budget_id={{budget_id}}" method = "post" data-parsley-validate class="form-horizontal form-label-left">{% csrf_token %}
                        <input type="hidden" name="slug" value="{{project_slug}}">
                        <input type="hidden" name="budget_id" value="{{budget_id}}">
                    {% if message %}<p style="color:red"><b>{{message}}</b></p>{% endif %}
                                        <small>Note: Fields marked with Asterisk (<span class="required" style="color:red">*</span>) are mandatory</small></br></br>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Super Category Label <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                            <input type="text" name="super-category" required>
                            </div>
                        </div>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Category 1 <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                            <input type="text" name="category_1"  required />
                            </div>
                        </div>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Category 2 <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                            <input type="text" name="category_2"  >
                            </div>
                        </div>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Category 3 <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                            <input type="text" name="category_3"  >
                            </div>
                        </div>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Category 4 <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                            <input type="text" name="category_4"  >
                            </div>
                        </div>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Category 5 <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                            <input type="text" name="category_5"  >
                            </div>
                        </div>

                        <div class="row">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Category 6 <span class="required" style="color:red">*</span>
                            </label>
                            <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                            <input type="text" name="category_6" >
                            </div>
                        </div>

                    {% endif %}

                        <div class="ln_solid"></div>
                                <div class="form-group">
                                    <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                                    {% if key == "budget" %}
                                        <input type="submit" class="btn btn-success" value="Save and add SuperCategory">
                                    {% else %}
                                        <input type="submit" value="Save and add Budget Lineitems" class="btn btn-success">
                                    {% endif %}
                                        <input class="btn btn-primary" type="button" value="Cancel" onClick="parent.location='/manage/project/budget/list/?slug={{project_slug}}'">
                                    </div>
                                </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="http://code.jquery.com/jquery-migrate-1.0.0.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://rawgit.com/Pixabay/jQuery-tagEditor/master/jquery.caret.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://rawgit.com/Pixabay/jQuery-tagEditor/master/jquery.tag-editor.js"></script>
<link rel="stylesheet" href="https://rawgit.com/Pixabay/jQuery-tagEditor/master/jquery.tag-editor.css">


<script>
  $( function() {
    $( "#id_actual_start_date" ).datepicker({
        format: 'yyyy-mm'
    });
    $( "#id_end_date" ).datepicker({
        format: 'yyyy-mm-dd'
    });
  } );
</script>

<script type="text/javascript">
    $(document).ready(function(){

        $.validator.addMethod("endDate", function(value, element) {
            var startDate = $('#id_actual_start_date').val();
            aa = startDate.split("-")
            aab = [aa[2], aa[1], aa[0]]
            sd = aab.join("-")
            bb = value.split("-")
            bbb = [bb[2], bb[1], bb[0]]
            ed = bbb.join("-") 
            return Date.parse(sd) <= Date.parse(ed) || value == "";
        }, "* End date must be after start date");
        
        $("#ic_form").validate({
            rules :
            {
                actual_start_date : {required:true},
                end_date : {required:true},
            },
            messages:
            {
                actual_start_date : {required : "Please Choose the Start Date"},
                end_date : {required:"Please Choose the End Date"},
            },
    });
            highlight: function (element) {
                $(element).parent().addClass('error')
            },
            unhighlight: function (element) {
                $(element).parent().removeClass('error')
            },
        });
        });
        
</script>



<style>
.error{color:red; min-width: 200px;}
</style>


<script>
  $("#id_end_date").datepicker({
    dateFormat: 'yy-mm-dd',
    onSelect: function(dateText, inst) {
        var start = new Date($('#id_actual_start_date').val());
        var end = new Date($('#id_end_date').val());
        if (end <= start) {
            alert("'End date' should be greater than 'Start date'")
            document.getElementById('dateError').innerHTML="End date should be greater than Start date"
        };
        if (end > start) {
            document.getElementById('dateError').innerHTML=""
            document.getElementById('dateError1').innerHTML=""
        };

        var months = (end.getFullYear() - start.getFullYear()) * 12;
        months += end.getMonth() - start.getMonth();
        document.getElementById("id_duration").value = months;
    }

});
  $("#id_actual_start_date").datepicker({
    dateFormat: 'yy-mm-dd',
  });
</script>
{% endblock %}

