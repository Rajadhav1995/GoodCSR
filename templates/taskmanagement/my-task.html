{% extends 'base.html' %}
{% load common_tags %}
{% load urs_tags %}
{% block section %}
<style>
    .error { color :red;}
    .errorlist li{color :red;}
    #size_upload{color: red;}
    #date_error,#min_max {color : red;}
</style>
<section class="green-pad green-height">
   <div class="row">
      <div class="image-pad logo-shadow">
         <a href="javascript:void(0);"><img class="border-pad" src="/static/img/logo-v.png" alt="" title="" ></a><a href="javascript:void(0);"><img src="img/logo-n.png" alt="" title="" ></a>
      </div>
      <div class="title-left">
         <h4>
         {% if project %}
            <a href = '/project/detail/?slug={{project.slug}}'><p class="trunc" style="width:620px;">
               {{project.name}}
               </p></a>
               {% else %} <a href = '#'>Project Name</a>
         </h4>
         {% endif %}
         <ul>
         {% get_funder project as project_funders %}
         <li><a href="">by {% if project_funders.funder.name %} {{project_funders.funder.name}} {% else %} Funder {% endif %}</a> </li>
         <li><a href="">NGO Partner: {% if project_funders.implementation_partner.name %} {{project_funders.implementation_partner.name}} {%else %}{% endif %}</a></li>
         </ul>
      </div>
      <a id="myBtn1" class="green-link green-link1" href="javascript:void(0);"> <img src="/static/img/generator-report.png" alt=""> &nbsp;Generate Report</a>
      <div class="menu-bottom">
         <ul>
            <li><a  href="/project/summary/?slug={{project.slug}}">Summary</a></li>
            <li><a href="/managing/listing/?slug={{project.slug}}">Task & Milestone</a></li>
            <li><a href="/manage/project/budget/view/?slug={{project.slug}}">Budget</a></li>
            <li><a href="/upload/list/?slug={{project.slug}}&model=Project">Files</a></li>
            <li><a href="/project/tranche/list/?slug={{project.slug}}">Tranches</a></li>
            <li><a class="active" href = '/managing/my-tasks/details/?slug={{project.slug}}'>My Tasks </a></li>
         </ul>
      </div>
   </div>
</section>
<!--Green pad Ends-->
{% endblock %}
{% block content %}
<div class="clear"></div>
<!--Content part starts-->
<section class="content-part">
   <div class="row">
      <div class="left-task">
         <div class="content-top content-top-task">
<!--            <div class="select-area">-->
<!--               <label>Sort by </label>-->
<!--               <div class="small-select">-->
<!--                  <select name="lang" class="select_box ">-->
<!--                     <option>Priority</option>-->
<!--                     <option>Ascending</option>-->
<!--                     <option>Descending</option>-->
<!--                  </select>-->
<!--               </div>-->
<!--            </div>-->
         </div>
         <div id="boxscroll-pad">
            <div class="task-head">
               <h4>Overdue</h4>
               <span>{% if over_due %}{{over_due | length }} {% else %} 0{% endif %}</span>
            </div>
            <ul>
               {% if over_due %}
               {% for task in over_due %}
               <li><a href = # class="hide-show"  id={{task.slug}} >{{task.name}} <span>{{task.start_date |date:'jS F Y'}} - {{task.activity.name}}</span></a></li>
               {% endfor %}
               {% endif %}
            </ul>
            <div class="task-head current-date">
               <h4>Today</h4>
               <span>{% if tasks_today %}{{tasks_today | length }} {% else %} 0{% endif %}</span>
            </div>
            <ul>
               {% if tasks_today %}
               {% for i in tasks_today %}
               <li><a href = # class="hide-show" id={{i.slug}}>{{i.name}} <span>{{i.start_date|date:'jS F Y'}} - {{i.activity.name}}</span></a></li>
               {% endfor %}
               {% else %}
               <li><a href="javascript:void(0);">No tasks</a></li>
               {% endif %}
            </ul>
            <div class="task-head">
               <h4>Tommorow</h4>
               <span>{% if tasks_tomorrow %}{{tasks_tomorrow | length }} {% else %} 0{% endif %}</span>
            </div>
            <ul>
               {% if tasks_tomorrow %}
               {% for j in tasks_tomorrow %}
               <li><a href = # class="hide-show" id={{j.slug}}>{{j.name}} <span>{{j.start_date|date:'jS F Y'}} - {{j.activity.name}}</span></a></li>
               {% endfor %}
               {% else %}
               <li><a href="javascript:void(0);">No tasks</a></li>
               {% endif %}
            </ul>
            <div class="task-head">
               <h4>Tasks</h4>
               <span>{% if remain_tasks %}{{remain_tasks | length }} {% else %} 0{% endif %}</span>
            </div>
            <ul>
               {% if remain_tasks %}
               {% for t in remain_tasks %}
               <li><a href = # class="hide-show" id={{t.slug}}>{{t.name}} <span>{{t.start_date|date:'jS F Y'}} - {{t.activity.name}}</span></a></li>
               {% endfor %}
               {% else %}
               <li><a href="javascript:void(0);">No tasks</a></li>
               {% endif %}
            </ul>
         </div>
      </div>
      {% for i in task_listing %}
      <div class="right-task div-{{i.slug}}">
       <div class="border-bottom">
         <div class="task-head-lft ">
            <h4>{{i.name}}<img src="/static/img/vender-icon.png" alt=""></h4>
            <h5>in <span class="under-line">{{i.activity.project.name}}</span> for <span>{{i.activity.name}}</span> <img src="/static/img/material-icon.png" alt=""></h5>
            <p>Details: This project works for child development, health and
               welfare of Ramnagar village in Andhra Pradesh. 
            </p>
         </div>
         <div class="task-head-rgt">
            <div class="my-progress-bar"></div>
<!--            <img src="/static/img/progress-icon.png" alt="">-->
            <p>{%if i.task_progress %}{{i.task_progress}}% {% else %}0%{% endif %} in progress</p>
         </div>
         </div>
         <div class="planned-date">
            <ul>
               <li>Planned Start Date : <span>{{i.start_date|date:'jS F Y'}}</span></li>
               <li>Planned End Date&nbsp;&nbsp;&nbsp;: <span>{{i.end_date|date:'jS F Y'}}</span></li>
            </ul>
            <ul>
               <li>Actual Start Date : <span>{{i.actual_start_date|date:'jS F Y'}}</span></li>
               <li>Actual End Date&nbsp;&nbsp;&nbsp;: <span>{{i.actual_end_date|date:'jS F Y'}}</span></li>
            </ul>
         </div>
         <div class="planned-pad">
            <ul>
               <li><span>Assigned to</span> <img src="/static/img/default_profile_image.png" alt=""></li>
               <li><span>Created by </span><img src="/static/img/default_profile_image.png" alt=""></li>
               <li><span>Approval</span> <img src="/static/img/default_profile_image.png" alt=""></li>
               <li><span>Subscribed to</span>{% for sub in i.subscribers.all|slice:"0:2" %} 
               <img src="/static/img/default_profile_image.png" alt="">{%endfor%}</li>{%if i.subscribers.all|length >= 3 %}. . . .{% endif %}
            </ul>
         </div>
         <div class="task-completion">
            <div class="task-completion-left">
               <img class="user-image" src="/static/img/default_profile_image.png" alt="">
            </div>
            <div class="task-completion-right">
                <form action ='/managing/my-tasks/updates/' id = 'updation_form' method='POST' enctype="multipart/form-data">{% csrf_token %}
                <input id = 'task_id' name = 'task_id' type='hidden' value = "{{i.id}}"/>
               <textarea name="comment" onFocus="if(this.value==this.defaultValue)this.value='';" onBlur="if(this.value=='')this.value=this.defaultValue;" placeholder = "Write a update..."></textarea>
               <div>
               <i class="fa fa-file"></i>
               <input type='file' name ='upload_attach' id='upload-photo'/> 
<!--               <label id = "size_upload" >"Please keep filesize under 5 MB"</label>-->
               </div>
                
               <div class="task-details">
               {% get_assigned_to user as assigned %}
                {% if i.status != 2 %}
                  <h4>Task Completion Status (%)</h4>
<!--                  <div class="range-holder">-->
<!--                     <div id="pr-slider" class="dragdealer">-->
<!--                        <div class="stripe">-->
<!--                           <div class="handle">-->
<!--                              <div class="square">-->
<!--                              </div>-->
<!--                           </div>-->
<!--                        </div>-->
<!--                     </div>-->
<!--                     <ul>-->
<!--                        <li>10</li>-->
<!--                        <li>20</li>-->
<!--                        <li>30</li>-->
<!--                        <li>40</li>-->
<!--                        <li>50</li>-->
<!--                        <li>60</li>-->
<!--                        <li>70</li>-->
<!--                        <li>80</li>-->
<!--                        <li>90</li>-->
<!--                        <li>100</li>-->
<!--                     </ul>-->
<!--                  </div>-->
                
                <div style="width:500px;">
                        <input type="hidden" name="child2" class="range" id="childAge" data-options='{"max": 100, "rangeType": "multiple", "minHandles": 0, "maxHandles": 0, "scale": {"labels": true, "interval": 10}}' value="" />
                </div>
                {% endif %}
                  <input class="task-link" type="submit" value="Add update"/>
                  </form>
               </div>
            </div>
         </div>
         <div class="user-timeline">
         {% if i.task_attachments %}
            <div id="boxscroll-timeline">
               {% for task_attach in i.task_attachments %}
               {% for dates,attach in task_attach.items %}
               <div class="month-pad">{{dates|date:'jS F Y'}}</div>
               <ul>
                  <li>
                     {% for a in attach %}
                     {% if a.attachment_type == 1 %}
                     <div class="left-li"><img class="user-image" src="/static/img/default_profile_image.png" alt=""></div>
                     
                     <div class="right-li first-li">
                            {% if a.attachment_file %}
                        <p>{% if a.description %}{{a.description|safe}} {% endif %}</p>
                        <ul>
                           <li>
                              <a href="{{image_url}}{{a.attachment_file.url}}">
                                 <img src="{{image_url}}{{a.attachment_file.url}}" width="162" height="112" alt="">
<!--                                 <div class="/static/image-hover">4 More files</div>-->
                              </a>
                           </li>
                            
                        </ul>
                        <span>{{a.created.time|date:"g:i a"}}</span>
                        {% endif %}
                     </div>
                     
                  </li>
                  {% elif a.attachment_type == 2 %}
                  <li>
                     <div class="left-li"><img class="user-image" src="/static/img/default_profile_image.png" alt=""></div>
                     {% if a.created_by %}
                     {{a.created_by.name}}{% else %}Unknown{% endif %} uploaded
                     <div class="right-li second-li">
                     
                        <ul>
                           {% if a.attachment_file %}
                           
                           <li>
                                
                              <a href="{{image_url}}{{a.attachment_file.url}}">
                              {% if a.document_type == 3 %}
                              <img src="/static/img/ppt-icon.png" alt=""> <span>{{a.name}}</span></a>
                              {% elif a.document_type == 1 %}
                              <img src="/static/img/excel-icon.png" alt=""> <span>{{a.name}}</span></a>
                              {% else %}
                              <img src="/static/img/textbox-bg.png" alt=""> <span>{{a.name}}</span></a>
                              {% endif %}
                           </li>
                        </ul>
                        <span>{{a.created.time|date:"g:i a"}}</span>
                        {% endif %}
                     </div>
                  </li>
                  {% endif %}
                  {% endfor %}
                  {% task_comments dates i.id as comments %}
                  {%if comments %}
                  <li>
                    {% for c in comments %}
                     <div class="left-li"><img class="user-image" src="/static/img/default_profile_image.png" alt=""></div>
                     
                     <div class="right-li third-li">
                        <ul>
                           <li>{% if c.text %}{{c.text}}{% endif %}</li>
                        </ul>
                        <span>{{c.created.time |date:"g:i a"}}</span>
                            
                     </div>
                     {% endfor %}
                     
                  </li>
                  {% endif %}
               </ul>
               {% endfor %}
               {% endfor %}
            </div>
            {% else %}
                    <li>No updates</li>
                  {% endif %}
         </div>
      </div>
      {% endfor %}
   </div>
</section>
<!--Content part Ends-->
{% endblock %}
{% block script %}
<!-- jQuery (necessary for JavaScript plugins) -->
<script type="text/javascript" src="/static/js/jquery.selectbox-0.2.js"></script>
<script type="text/javascript" src="/static/js/ddsmoothmenu.js"></script>
<script type="text/javascript" src="/static/js/jquery.mmenu.min.all.js"></script>
<script type="text/javascript" src="/static/js/common.js" /></script>
<!--<script type="text/javascript" src="js/jquery.scrollbox.js"></script>-->
<script src="/static/js/jquery.nicescroll.min.js"></script>
<script src="/static/js/easyResponsiveTabs.js" type="text/javascript"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
<script src="/static/js/plugin.js" type="text/javascript"></script>
<script src="/static/js/script.js" type="text/javascript"></script> 


<link href="/static/css/sample.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
<link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/static/css/jquery.range-control.css" />
    <script src="/static/js/jquery.range-control.js"></script>
<!--<script>-->
<!--$(document).ready(function() {-->
<!--    $(".my-progress-bar").circularProgress({-->
<!--        line_width: 6,-->
<!--        color: "#333",-->
<!--        starting_position: 0, // 12.00 o' clock position, 25 stands for 3.00 o'clock (clock-wise)-->
<!--        percent: 0, // percent starts from-->
<!--        percentage: true,-->
<!--        text: ""-->
<!--    }).circularProgress('animate', 50, 5000);-->
<!--});       -->
<!--</script>-->
<script>
   //Toggle
   
   	$('.user-menu').on('click',function(){
   		$('.dropdown-menu').slideDown(350);
   
   	});
   	$('.select-down').on('click',function(){
           $('.dropdown-menu1').slideDown(350);
   
       });
   
   	$(document).ready(function(e) {
   		/*Content Show/Hide */
   		$('.hide-cont').hide();
   		$('.close-cont').hide();
   		$('.view-cont').click(function(){
   			$('.hide-cont').slideDown(350);
   			$('.close-cont').show();
   			$('.view-cont').hide();
   		});
   		$('.close-cont').click(function(){
   			$('.hide-cont').slideUp(350);
   			$('.close-cont').hide();
   			$('.view-cont').show();
   		});
   		$(document).trigger( "click" );
   	});
   
   	$(document).click(function(){
   
   		$('.user-menu, .select-down').click(function(event){
   			event.stopPropagation();
   		});
   
   		$('.dropdown-menu, .dropdown-menu1').slideUp(350);
   
   	});
</script>
<script type="text/javascript">
   var expanded = false;
   
   function showCheckboxes() {
    var checkboxes = document.getElementById("checkboxes");
    if (!expanded) {
      checkboxes.style.display = "block";
      expanded = true;
    } else {
      checkboxes.style.display = "none";
      expanded = false;
    }
   }
      
</script>
<script>
   $(document).ready(function() {
     $("#boxscroll-pad").niceScroll({cursorborder:"",cursorcolor:"#949494",boxzoom:true});
   // First scrollable DIV
   $("#boxscroll-timeline").niceScroll({cursorborder:"",cursorcolor:"#949494",boxzoom:true});
   });
   $(document).resize(function() {
   $("#boxscroll-pad").niceScroll({cursorborder:"",cursorcolor:"#949494",boxzoom:true});
   // First scrollable DIV
   $("#boxscroll-timeline").niceScroll({cursorborder:"",cursorcolor:"#949494",boxzoom:true});
   });
</script>
<script type="text/javascript">
   $(document).ready(function () {
       $('#horizontalTab').easyResponsiveTabs({
           type: 'default', //Types: default, vertical, accordion
           width: 'auto', //auto or any width like 600px
           fit: true,   // 100% fit in a container
           closed: 'accordion', // Start closed if in accordion view
           activate: function(event) { // Callback function if tab is switched
               var $tab = $(this);
               var $info = $('#tabInfo');
               var $name = $('span', $info);
               $name.text($tab.text());
   
               $info.show();
           }
       });
   });
</script>
<script src="/static/js/jquery.simplePopup.js" type="text/javascript"></script>
<script type="text/javascript">
   $(document).ready(function(){
       $('#myBtn1').click(function(){
   	$('#pop3').simplePopup();
       });
   });
</script>
<!---datepicker script-->
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
<script>
   $(function() {
   $( ".datepicker" ).datepicker({
   showOn: "button",
   buttonImage: "img/calender-icon.png",
   buttonImageOnly: true
   });
   });
</script>
<script src="/static/js/price-range.js"></script>
<script>
   $(function(){
   
       $('.hide-show').on('click',function(){
           var sl_id = $(this).attr('id')
           $('.right-task').hide();
           $('.div-'+sl_id).show();
       });
       $('.hide-show').first().trigger('click');
   }
   );
</script>
<script>
    $(function(){
        var key = "{{request.GET.key}}"
        console.log(key);
        if (key !=''){
        $('.right-task').hide();
        $(".div-"+key).show();
        $(".hide-show").addClass('active');
        }
        else{
        $('.hide-show').first().trigger('click');
        }
       });
</script>

<script>
        
    $(document).ready(function(){

        $("#updation_form").validate({
            rules :
            {
                comment : {required:true},
                
            },
            messages:
            {
                comment : {required : "Please enter an update"},
            },
            highlight: function (element) {
                $(element).addClass('error')
            },
            unhighlight: function (element) {
                $(element).removeClass('error')
            },
        });
        });
        
</script>


<script>
   $('.range').rangeControl({
  min: 10,
  max: 110,
  step: 2,
  delim: '',
  orientation: 'horizontal',
  disabled: false,
  rangeType: 'single',
  minHandles: 1,
  maxHandles: 1,
  allowPaging: true,
  stepsPerPage: 11,
  currentValue: {
    position: 'top'
  },
  scale: {
    position: 'bottom',
    labels: true,
    interval: 10
  },
  className: ''
});

    // $('#childAge').on({
    //     'rangeControlAddHandle.rangeControlEvent rangeControlRemoveHandle.rangeControlEvent': function () {
         
    //         var index = (this.value.length == 0) ? 0 : this.value.split(' ').length;
    //         $('#childCount')[0].selectedIndex = index;
    //         $('#childCountView').text(index);
           
    //     },
    //     'rangeControlChange.rangeControlEvent': function () {

    //         alert(this.value);
           
    //         $('#childAgeView').show().children().text(this.value.split(' ').join(', '));
    //     }
    // });

    // $('.range').on('rangeControlChange.rangeControlEvent', function () {

        
    //   // on change event
    // });

    $('.range').on('rangeControlSlide.rangeControlEvent', function () {
      // on slide event

         
      

     // $('#childAgeView').show().children().text(this.value.split(' ').join(', '));
      $('#slectedNumber').html($('.range-control-current-value').text());
      
    });

    $('.range').on('rangeControlChange.rangeControlEvent', function () {
         $('#slectedNumber').html($('.range-control-current-value').text());
    });


  

</script>

<!--ZZ-->
{% endblock %}
