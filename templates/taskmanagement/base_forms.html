{% extends 'base.html' %}

{% block section %}
<div> </div>
{% endblock %}

<style>
    .error,.errorlist { color :red;}
    #date_error,#min_max {color : red;}
</style>


{% block content %}
<div class="clear"></div>
<section class="content-part">
    <div class='container' >
	<div class="white-box">
	
    <form class="form-horizantal budget_form" action="{{request.path}}" method='POST' enctype="multipart/form-data">{% csrf_token %}
     <div class="col-md-12">
        {% if slug %}
                   <h3 class="border_line">Edit {{model_name}}</h3>
                  {% else %}
                     <h3 class="border_line">Add {{model_name}}</h3>
                  {% endif %}
        </div>
       <div class="col-md-6 nopadding">
            <form action="{{request.path}}" method='POST' enctype="multipart/form-data">{% csrf_token %}
                    {% for field in form %}
                         {{form.media}}
                        <div class="col-md-12">
                            <div class="form-group">
                                
                                <label>{{field.label_tag}}</label>
                                {{field}}
                                {{field.errors}}
                            </div>
                        </div>
                    {% endfor %}
            <input id = 'slug' name = 'slug_project' type='hidden' value = "{{project.slug}}"/>
           <div class="col-md-12">
            <div class="form-group">
              <input class="budget_button" type="submit" value="Save" onclick="return RemoveProduct();" />
              <a class="btn btn-success" href="/managing/listing/?slug={{project.slug}}" style="margin-right:5px;float: right;">Back</button></a>
            </div>
           </div>
        </div>
    </form>
    
    
    </div>
    </div>
</section>
<!--Content part Ends-->
{% endblock %}
<!--Footer starts-->


</div>


{% block script %}
<!-- jQuery (necessary for JavaScript plugins) -->
<script type="text/javascript" src="/static/js/jquery.selectbox-0.2.js"></script>
<script type="text/javascript" src="/static/js/ddsmoothmenu.js"></script>
<script type="text/javascript" src="/static/js/jquery.mmenu.min.all.js"></script>
<script type="text/javascript" src="/static/js/common.js" /></script>
<script src="/static/js/fSelect.js"></script>
<!--<script type="text/javascript" src="js/jquery.scrollbox.js"></script>-->
<script src="/static/js/jquery.nicescroll.min.js"></script>

<script>
//Toggle
		
		 $('.user-menu').on('click',function(){
          $('.dropdown-menu').slideToggle();
          
        });
		 $(document).ready(function(e) {	
	/*Content Show/Hide */
	$('.hide-cont').hide();
	$('.close-cont').hide();
	$('.view-cont').click(function(){
		$('.hide-cont').slideDown(350);
		$('.close-cont').show();
		$('.view-cont').hide();
	});
	$('.close-cont').click(function(){
		$('.hide-cont').slideUp(350);
		$('.close-cont').hide();
		$('.view-cont').show();
	});	
 });
	
</script>

    <script type="text/javascript">
   
	
	var expanded = false;

function showCheckboxes() {
  var checkboxes = document.getElementById("checkboxes");
  if (!expanded) {
    checkboxes.style.display = "block";
    expanded = true;
  } else {
    checkboxes.style.display = "none";
    expanded = false;
  }
}
    </script>
    <script>
  $(document).ready(function() {
  
	var nice = $("html").niceScroll();  // The document page (body)
	
	$("#div1").html($("#div1").html()+' '+nice.version);
    
    $("#boxscroll, .table-resp tbody").niceScroll({cursorborder:"",cursorcolor:"#949494",boxzoom:true}); // First scrollable DIV

    
  });
</script>
<script src="/static/js/bootstrap.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  
<script>
    $(document).ready(function() {
        $( "#id_date" ).datepicker({ dateFormat: 'yy-mm-dd' });
        $( "#id_end_date" ).datepicker({ dateFormat: 'yy-mm-dd' });
        $( "#id_actual_start_date" ).datepicker({ dateFormat: 'yy-mm-dd' });
        $( "#id_actual_end_date" ).datepicker({ dateFormat: 'yy-mm-dd' });
        });
</script>
<!--  <script>-->
<!--  $( function() {-->
<!--    var dateFormat = "mm/dd/yy",-->
<!--      from = $( "#id_start_date" )-->
<!--        .datepicker({-->
<!--          defaultDate: "+1w",-->
<!--          changeMonth: true,-->
<!--          numberOfMonths: 1-->
<!--        })-->
<!--        .on( "change", function() {-->
<!--          to.datepicker( "option", "minDate", getDate( this ) );-->
<!--        }),-->
<!--      to = $( "#id_end_date" ).datepicker({-->
<!--        defaultDate: "+1w",-->
<!--        changeMonth: true,-->
<!--        numberOfMonths: 1-->
<!--      })-->
<!--      .on( "change", function() {-->
<!--        from.datepicker( "option", "maxDate", getDate( this ) );-->
<!--      });-->
<!-- -->
<!--    function getDate( element ) {-->
<!--      var date;-->
<!--      try {-->
<!--        date = $.datepicker.parseDate( dateFormat, element.value );-->
<!--      } catch( error ) {-->
<!--        date = null;-->
<!--      }-->
<!-- -->
<!--      return date;-->
<!--    }-->
<!--  } );-->
<!--</script>-->

<script>
$(function($) {
    $(function() {
        $('.test').fSelect();
    });
});
</script>
<script>
    $(document).ready(function() {
        $('#is_subscribers').addClass('test');
        $('#id_task').addClass('test');
        $("#id_task_dependency").addClass('test');
        $("#id_description").addClass('form-control text_area');
    });
</script>


<script>
    $(document).ready(function() {
    if ('{{model_name}}' == 'Milestone'){
    $('#id_task').on('change',function(e){
        var tasks_ids = $('#id_task').val();
        $.ajax({
            url:'/managing/milestone/overdue/',
            type:'GET',
            data:{'id':tasks_ids},
            async: true,
            dataType:"json",
            success:function(data){
            if (data.milestone_overdue_date != ""){
                document.getElementById("id_overdue").value = data.milestone_overdue_date;
             }
            else{
                $( "#id_overdue_date" ).datepicker({ dateFormat: 'yy-mm-dd' });
                }
            },
            error : function(){}
        });
        e.stopImmediatePropagation();
        return false;
      });
    }
    });
</script>

<script>
    $(document).ready(function() {
    $('#id_activity').on('change',function(e){
        
        var select_id = $('#id_activity').val();
        $.ajax({
            url:'/managing/task/dependencies/',
            type:'GET',
            data:{id:select_id},
            dataType:"json",
            success:function(data){
                if (data.project_start_date != ""){
                    document.getElementById("id_start_date").value = data.project_start_date;
                 }
                else{
                    $( "#id_start_date" ).datepicker({ dateFormat: 'yy-mm-dd' });
                    }
                //document.getElementById("id_task_dependency").value = data.tasks_dependency;
                //$('#id_task_dependency')
                  //  .find('option')
                    //.remove()
                    //for(var i=0;i<data.tasks_dependency.length;i++){
                        
                      //  $('#id_task_dependency').append('<option value='+data.tasks_dependency[i]['id']+'>'+data.tasks_dependency[i]['name']+'</option>')
                        //}
            },
            error : function(){}
        });
        e.stopImmediatePropagation();
        return false;
      });
    });
</script>

<script>
    $(document).ready(function() {
    if ('{{model_name}}' == 'Task'){
    $('#id_task_dependency').on('change',function(e){
        var dependency_id = $('#id_task_dependency').val();
        $.ajax({
            url:'/managing/tasks/auto-computation/date',
            type:'GET',
            data:{'id':dependency_id},
            dataType:"json",
            success:function(data){
            if (data.computation_date != ""){
                document.getElementById("id_start_date").value = data.computation_date;
             }
            else {
                $( "#id_start_date" ).datepicker({ dateFormat: 'yy-mm-dd' });
                }
                
            },
            error : function(){}
        });
        e.stopImmediatePropagation();
        return false;
      });
    }
    });
</script>

{% endblock %}


