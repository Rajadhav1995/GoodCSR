{% extends 'base.html'%}
{% load urs_tags %}
{% block section %}
<div class="clear"></div>
<!--Green pad starts-->
<section class="green-pad green-height">
	<div class="row">
	<div class="image-pad logo-shadow">
    	<a href="javascript:void(0);"><img class="border-pad" src="/static/img/logo-v.png" alt="" title="" ></a><a href="javascript:void(0);"><img src="img/logo-n.png" alt="" title="" ></a>
    </div>    
    <div class="title-left">
    {% if project %}
    <h4><a href = '/project/detail/?slug={{project.slug}}'><p class="trunc" style="width:620px;">{{project.name}}</p></a></h4>
    {% else %}
    <h4><a href = '#'>Project Name</a></h4>
    {% endif %}
    <ul>
        {%if project_funders %}
    	<li><a href="">by {% if project_funders.funder.name %} {{project_funders.funder.name}} {% endif %}</a> </li>
        <li><a href="">NGO Partner: {% if project_funders.implementation_partner.name %} {{project_funders.implementation_partner.name}}{% endif %}</a></li>
        {% else %}
        <li><a href="">by Funder</a> </li>
        <li><a href="">NGO Partner: </a></li>
        {% endif %}
    </ul>    
    </div>
    <a id="myBtn1" class="green-link green-link1" href="javascript:void(0);"> <img src="/static/img/generator-report.png" alt=""> &nbsp;Generate Report</a>
     <div class="menu-bottom">
        <ul>
          <li><a  href="/project/summary/?slug={{project.slug}}">Summary</a></li>
          <li><a class="active" href="/managing/listing/?slug={{project.slug}}">Task & Milestone</a></li>
          <li><a href="/manage/project/budget/view/?slug={{project.slug}}">Budget</a></li>
          <li><a href="/upload/list/?slug={{project.slug}}&model=Project">Files</a></li>
          <li><a href="/project/tranche/list/?slug={{project.slug}}">Tranches</a></li>
          <li><a href = '/managing/my-tasks/details/?slug={{project.slug}}'>My Tasks </a></li>
        </ul>
     </div>         
    </div>
</section>
<!--Green pad Ends-->
{% endblock %}
<!--Content part starts-->

{% block content %}
<div class="clear"></div>
<!--Content part starts-->
<section class="content-part">
	<div class="row">
	
	<div class=" white-box ">
<!--    	<img src="/static/img/wip-img.jpg" alt="">-->
        <div id="gwContainer" className="col-md-12 gantt" style="padding-top: '25px', position: 'relative', height: 'auto', width:'100%'"></div>
    </div>
<div class="green-box">
   <div class="green-box-lft">
      <h2>Activities</h2>
      <div class="green-content">
         <div id="boxscroll-atm">
            <ul>
               {% if activity_list %}
               {% for i in activity_list %}
               <li><a href="javascript:void(0);">{{i.name}}<span>({{i.get_activity_type_display}}) <i class="fa fa-edit" style="float:right" onclick="activity('{{i.slug}}','{{project.slug}}')"></i></span>
               {% get_user_permission request as user_obj %}
<!--                    {% if user_obj.is_admin_user == True %}-->
                  
                      <!-- <a href="/managing/Activity/ActivityForm/edit/{{i.slug}}/?key={{project.slug}}"></a> -->
                  
<!--                    {% endif %}-->
                    </a>
               </li>
               {% endfor %}
               {% else %}
               <li><a href="javascript:void(0);"> No activites are created</a></li>
               {% endif %}
            </ul>
         </div>
         <div class="clear"></div>
                  {% get_user_permission request as user_obj %}
                    {% if user_obj.is_admin_user == True %}
                    <a class="add-task" href="/managing/Activity/ActivityForm/add/?slug={{project.slug}}">Add Activity</a>
                    {% endif %}
      </div>
   </div>
      <div class="green-box-lft">
         <h2>Tasks</h2>
         <div class="green-content">
            <div id="boxscroll-atm1">
               <ul>
                  {% if task_list %}
                  {% for task in task_list %}
                  <li><a href="javascript:void(0);">{{task.name}} <span>{{task.start_date | date:"jS M"}} - {{task.end_date | date:'jS M'}}{% if task.status != 2 %}<i class="fa fa-edit" style="float:right" onclick="task('{{task.slug}}','{{project.slug}}')"></i>{% endif %}</span>
<!--                    {% get_user_permission request as user_obj %}-->
<!--                    {% if user_obj.is_admin_user == True %}-->
<!--                     <a class="add-task" href="/managing/Task/TaskForm/edit/{{task.slug}}/?key={{project.slug}}"><i class="fa fa-edit"></i> </a></a>-->
<!--                     {% endif %}-->
                    </a>
                  </li>
                  {% endfor %}
                  {% else %}
                  <li><a href="javascript:void(0);"> No tasks are created </a></li>
                  {% endif %}
               </ul>
            </div>
            <div class="clear"></div>
            {% get_user_permission request as user_obj %}
                    {% if user_obj.is_admin_user == True %}
            <a class="add-task" href="/managing/Task/TaskForm/add/?slug={{project.slug}}">Add Task</a>
                {% endif %}
         </div>
      </div>
      <div class="green-box-lft">
         <h2>Milestones</h2>
         <div class="green-content">
            <div id="boxscroll-atm2">
               <ul>
                  {% if milestone %}
                  {% for mile in milestone %}
                  <li><a href="javascript:void(0);">{{mile.name}} <span>(Due - {{mile.overdue|date:'jS M'}}){% if mile.status != 2 %}<i class="fa fa-edit" style="float:right" onclick="milestone('{{mile.slug}}','{{project.slug}}')"></i>{% endif %}</span>
<!--                  {% get_user_permission request as user_obj %}-->
<!--                    {% if user_obj.is_admin_user == True %}-->
<!--                                          <a class="add-task" href="/managing/Milestone/MilestoneForm/edit/{{mile.slug}}/?key={{project.slug}}"><i class="fa fa-edit"></i> </a> </a>-->
<!--                  {% endif %}-->
                    </a>
                  </li>
                  {% endfor %}
                  {% else %}
                  <li><a href="javascript:void(0);"> No milestones</a></li>
                  {% endif %}
               </ul>
            </div>
            <div class="clear"></div>
                {% get_user_permission request as user_obj %}
                    {% if user_obj.is_admin_user == True %}
                <a class="add-task" href="/managing/Milestone/MilestoneForm/add/?slug={{project.slug}}">Add Milestone</a>
                {% endif %}
         </div>
      </div>
   </div>
</div>
</section>
<!--Content part Ends-->

{% endblock %}

{% block script %}
<!-- jQuery (necessary for JavaScript plugins) -->
<script type="text/javascript" src="/static/js/jquery.selectbox-0.2.js"></script>
<script type="text/javascript" src="/static/js/ddsmoothmenu.js"></script>
<script type="text/javascript" src="/static/js/jquery.mmenu.min.all.js"></script>
<script type="text/javascript" src="/static/js/common.js" /></script>
<!--<script type="text/javascript" src="js/jquery.scrollbox.js"></script>-->
<script src="/static/js/jquery.nicescroll.min.js"></script>
 <script src="/static/js/easyResponsiveTabs.js" type="text/javascript"></script>

<script>
function activity(name,slug) {
    window.location.href="/managing/Activity/ActivityForm/edit/"+ name +"/?key="+slug;
}
function task(name,slug) {
    window.location.href="/managing/Task/TaskForm/edit/"+ name +"/?key="+slug;
}

function milestone(name,slug) {
    window.location.href="/managing/Milestone/MilestoneForm/edit/"+ name +"/?key="+slug;
}
</script>
<script>
//Toggle
		
	$('.user-menu').on('click',function(){
		$('.dropdown-menu').slideDown(350);
	
	});
	$('.select-down').on('click',function(){
        $('.dropdown-menu1').slideDown(350);
          
    });
	
	$(document).ready(function(e) {	
		/*Content Show/Hide */
		$('.hide-cont').hide();
		$('.close-cont').hide();
		$('.view-cont').click(function(){
			$('.hide-cont').slideDown(350);
			$('.close-cont').show();
			$('.view-cont').hide();
		});
		$('.close-cont').click(function(){
			$('.hide-cont').slideUp(350);
			$('.close-cont').hide();
			$('.view-cont').show();
		});	
		$(document).trigger( "click" );
	});
	
	$(document).click(function(){
	
		$('.user-menu, .select-down').click(function(event){
			event.stopPropagation();
		});
	
		$('.dropdown-menu, .dropdown-menu1').slideUp(350);	 
	
	});		 
</script>

    <script type="text/javascript">
   
	
	var expanded = false;

function showCheckboxes() {
  var checkboxes = document.getElementById("checkboxes");
  if (!expanded) {
    checkboxes.style.display = "block";
    expanded = true;
  } else {
    checkboxes.style.display = "none";
    expanded = false;
  }
}
    </script>
    <script>
  $(document).ready(function() {
  
    $("#boxscroll-atm").niceScroll("#boxscroll-atm ul",{cursorborder:"",cursorcolor:"#949494",boxzoom:true});
	// First scrollable DIV
	$("#boxscroll-atm1").niceScroll("#boxscroll-atm1 ul",{cursorborder:"",cursorcolor:"#949494",boxzoom:true});
	$("#boxscroll-atm2").niceScroll("#boxscroll-atm2 ul",{cursorborder:"",cursorcolor:"#949494",boxzoom:true});

    
  });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#horizontalTab').easyResponsiveTabs({
            type: 'default', //Types: default, vertical, accordion           
            width: 'auto', //auto or any width like 600px
            fit: true,   // 100% fit in a container
            closed: 'accordion', // Start closed if in accordion view
            activate: function(event) { // Callback function if tab is switched
                var $tab = $(this);
                var $info = $('#tabInfo');
                var $name = $('span', $info);

                $name.text($tab.text());

                $info.show();
            }
        });
		});
</script>
<script src="/static/js/jquery.simplePopup.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function(){
    $('#myBtn1').click(function(){
	$('#pop3').simplePopup();
    });
});
</script>

<!---datepicker script-->
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
<script>
	$(function() {
	$( ".datepicker" ).datepicker({
	showOn: "button",
	buttonImage: "img/calender-icon.png", 
	buttonImageOnly: true
	});
	});
</script>
<link href="/static/css/jsgantt.css" rel="stylesheet" type="text/css" />
  <script src="/static/js/jsgantt.js" type="text/javascript"></script>
<script>
    var jsonData = {{taskdict|safe}}
    var g = new JSGantt.GanttChart(document.getElementById('gwContainer'), 'week');
    $.each(jsonData.supercategories, function (i) {
      var superId = this.id;
      var superName = this.name;
      var superDesc = this.description;
      g.AddTaskItem(new JSGantt.TaskItem(superId, superName, '', '', 'ggroupblack', '', 0, null, 0, 1, 0, 1, '',
        '', superDesc, g));
      // console.log("Super");
      // console.log(superId, superName, '', '', 'ggroupblack', '', 0, null, 0, 1, 0, 1, '',
      //   '', superDesc);
    });
    $.each(jsonData.activities, function (i) {
      var activityId = this.id.toString();
      var superId = this.super_category;
      activityId = this.super_category.toString() + activityId;
      // console.log("ActID", activityId);
      var activityName = this.name;
      var activitySuper = this.super_category;
      var activityDesc = this.description;
      g.AddTaskItem(new JSGantt.TaskItem(activityId, activityName, '', '', 'ggroupblack', '', 0, '', 0, 2, superId,
        1, '', '',
        activityDesc, g));
      // console.log("Act");
      // console.log(activityId, activityName, '', '', 'ggroupblack', '', 0, '', 0, 2, superId,1, '', '',activityDesc);
    });
    $.each(jsonData.tasks, function (i) {
      var taskId = this.id;
      var activityId = this.activity;
      var activity_type = 'Core';
      // activity = jsonData.activities.filter(function( i ) {
      //   if(i.id == activityId){return i.super_category;}
      // });
      var superId = $.each(jsonData.activities, function () {
        if (this.id == activityId) {
          activity_type = this.activity_type;
          return this.super_category;
        }
      });
      taskId = superId[0].super_category.toString() + activityId.toString() + taskId.toString();
      activityId = superId[0].super_category.toString() + activityId.toString();
      activityId = parseInt(activityId);
      // console.log("TaskID", taskId);
      var taskName = this.name;
      var eStartDate = this.expected_start_date;
      var eEndDate = this.expected_end_date;
      var taskCompletion = 0;
      var taskStatus = 'gtaskred';
      if (activity_type == "Core") {
        switch (this.status) {
          case "Ongoing":
            taskStatus = 'gtaskblue';
            break;
          case "Open":
            taskStatus = 'gtaskyellow';
            break;
          case "Close":
            taskStatus = 'gtaskgreen';
            break;
          default:
            taskStatus = 'gtaskblue';
            break;
        };
      }
      g.AddTaskItem(new JSGantt.TaskItem(taskId, taskName, eStartDate, eEndDate, taskStatus, '', 0,
        '', 0, 0, activityId, 1, '', '', '', g));
      // console.log("Task");
      // console.log(taskId, taskName, eStartDate, eEndDate, taskStatus, '', 0,
      //   '', 0, 0, activityId, 1, '', '', '');
    });
    // g.AddTaskItem(new JSGantt.TaskItem(1, 'Nabarangpur School Project', '', '', 'ggroupblack', '', 0, 'Brian', 0, 1, 0,
    //   1, '', '', 'Some Notes text', g));
    // g.AddTaskItem(new JSGantt.TaskItem(11, 'Paper Work', '', '', 'ggroupblack', '', 0, 'Shlomy', 40, 2, 1, 1, '', '',
    //   '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(111, 'Constructor Proc', '2017-07-21', '2017-09-09', 'gtaskblue', '', 0,
    //   'Brian T.', 60, 0, 11, 1, '', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(112, 'Task Variables', '2017-09-06', '2017-09-11', 'gtaskred', '', 0, 'Brian',
    //   0, 0, 11, 1, 121, '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(113, 'Task by Minute/Hour', '2017-09-09', '2017-09-14 12:00', 'gtaskyellow', '',
    //   0, 'Ilan', 60, 0, 11, 1, '', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(114, '4th task', '2017-09-12', '2017-09-20 12:00', 'gtaskblue', '',
    //   0, 'Ilan', 60, 0, 11, 1, '', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(115, '5th task', '2017-09-14', '2017-09-27 12:00', 'gtaskblue', '',
    //   0, 'Ilan', 20, 0, 11, 1, '', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(13, 'Education', '2017-09-09', '2017-09-29', 'gtaskred', '', 0, 'Anyone', 60, 0,
    //   1, 1, '123SS', 'This is a caption', null, g));
    // g.AddTaskItem(new JSGantt.TaskItem(2, 'Create HTML Shell', '2017-09-24', '2017-09-28', 'gtaskyellow', '', 0,
    //   'Brian', 20, 0, 0, 1, 122, '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(3, 'Code Javascript', '', '', 'ggroupblack', '', 0, 'Brian', 0, 1, 0, 1, '', '',
    //   '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(31, 'Define Variables', '2017-09-25', '2017-09-29', 'gtaskgreen', '', 0, 'Brian',
    //   30, 0, 2, 1, '', 'Caption 1', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(32, 'Calculate Chart Size', '2017-09-15', '2017-09-24', 'gtaskgreen', '', 0,
    //   'Shlomy', 40, 0, 3, 1, '', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(33, 'Draw Task Items', '', '', 'ggroupblack', '', 0, 'Someone', 40, 2, 3, 1, '',
    //   '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(332, 'Task Label Table', '2017-09-06', '2017-09-09', 'gtaskblue', '', 0, 'Brian',
    //   60, 0, 33, 1, '331', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(333, 'Task Scrolling Grid', '2017-09-11', '2017-09-20', 'gtaskblue', '', 0,
    //   'Brian', 0, 0, 33, 1, '332', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(34, 'Draw Task Bars', '', '', 'ggroupblack', '', 0, 'Anybody', 60, 2, 3, 0, '',
    //   '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(341, 'Loop each Task', '2017-09-26', '2017-09-30', 'gtaskred', '', 0, 'Brian',
    //   60, 0, 34, 1, '', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(342, 'Calculate Start/Stop', '2017-04-12', '2017-05-18', 'gtaskred', '', 0, 'Brian', 60, 0, 34, 1, '', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(343, 'Draw Task Div', '2017-05-13', '2017-05-17', 'gtaskred', '', 0, 'Brian', 60, 0, 34, 1, '', '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(344, 'Draw Completion Div', '2017-05-17', '2017-07-04', 'gtaskred', '', 0, 'Brian', 60, 0, 34, 1, "342,343", '', '', g));
    // g.AddTaskItem(new JSGantt.TaskItem(35, 'Make Updates', '2017-09-17', '2017-09-04', 'gtaskblue', '', 0, 'Brian', 30, 0, 3, 1, '333', '', '', g));
    g.setShowStartDate(0);
    g.setShowEndDate(0);
    g.setShowRes(0);
    g.setShowDeps(0);
    g.setShowDur(0);
    g.setUseToolTip(0);
    g.setWeekColWidth(50);
    g.setWeekMajorDateDisplayFormat('mon yyyy');
    g.setWeekMinorDateDisplayFormat('W w');
    // g.setScrollTo('today');
    g.Draw();

    function collision($div1, $div2) {
      var x1 = $div1.offset().left;
      var y1 = $div1.offset().top;
      var h1 = $div1.outerHeight(true);
      var w1 = $div1.outerWidth(true);
      var b1 = y1 + h1;
      var r1 = x1 + w1;
      var x2 = $div2.offset().left;
      var y2 = $div2.offset().top;
      var h2 = $div2.outerHeight(true);
      var w2 = $div2.outerWidth(true);
      var b2 = y2 + h2;
      var r2 = x2 + w2;

      if (b1 < y2 || y1 > b2 || r1 < x2 || x1 > r2) return false;
      return true;
    }
    var count = 0,
      padding = 30,
      arrayTask = [],
      collide = false;
    $('.gselector').hide();
    $(document).ready(function () {
      var previous = null;
      var prePrevious = null;
      $(".gtaskbarcontainer").each(function (index) {
        currParent = $(this).parent().parent().parent();
        if (previous && $(this).parent().parent().parent().attr('id') == $(previous).parent().parent().parent()
          .attr('id')) {
          if (collision($(this), $(previous)) || collision($(this), $(prePrevious))) {
            listParent = currParent.attr('id').replace('row', '');
            console.log("PARENT",currParent.attr('id'));
            $('#'+currParent.attr('id')+" .gtaskbarcontainer").each(function(){

              if ($(this).css('top') == '-5px') {
                $(this).css('top', '0px');
              }
            });
            collide = true;
            $(this).css('top', parseInt($(previous).css('top')) + padding + 'px');
            if (count == 0) {
              $(previous).css('top', '0px');
              count++;
              padding = 25;
            }
            listParentDiv = $('#' + listParent);
            // console.log('Heights', $(this).css('top'), parseInt(currParent.css('height')));
            if (parseInt(currParent.css('height')) <= parseInt($(this).css('top'))) {
              listParentDiv.css('height', parseInt(listParentDiv.css('height')) + 25 + 'px');
              currParent.css({
                'height': parseInt(currParent.css('height')) + 25 + 'px',
                'vertical-align': 'top'
              });
            }
          }
        } else {
          count = 0;
          arrayTask = [];
          collide = false;
          $('#' + currParent.attr('id') + ' .gtaskbarcontainer').css({
            top: '-5px'
          });
        }
        prePrevious = previous;
        previous = this;
      });
    });
  </script>

<script>
{% endblock %}

