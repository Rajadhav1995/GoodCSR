{% extends 'base.html' %}

{% block section %}
<div> </div>
{% endblock %}
    <!-- Content Header (Page header) -->
<!--<style>
form { 
margin: 0 auto; 
width:450px;
}
</style>-->
<style>
.error {
    color: red !important;
    min-width: 200px;
}
</style>
    <!-- Main content -->
{% block content %}

<div class="clear"></div>
<section class="content-part">
    <div class='container' >
    <div class="white-box">
        
              <div class="col-md-12">
      <h3 class="border_line">Add Project</h3><br>
        </div>
              <!-- <div align="right">
             <a class="btn btn-success" href="/project/list/" ><i class="fa fa-arrow-left" aria-hidden="true"></i> Back</button></a>&#160;<input class="btn btn-primary" type="submit" form="prog_edit" value="Save" />
         </div> -->
            <!-- /.box-header -->
            <!-- <div class="box-body"> -->


            
            <form autocomplete="off" id="prog_edit" class ="form-horizantal budget_form" action="/project/add/?slug={{slug}}" method="POST" enctype="multipart/form-data">
            
            {% csrf_token %}
            <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>Project Name</label>
                    {{form.name}}
                    
                        </div>{% if form.errors %}
                        <p style="color: red;">
                            Project name Already exist
                        </p>
                        {% endif %}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>{{form.total_budget.label_tag}}</label>
                    {{form.total_budget}}
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>{{form.no_of_beneficiaries.label_tag}}</label>
                    {{form.no_of_beneficiaries}}
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>{{form.summary.label_tag}}</label>
                    {{form.summary}}
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>{{form.target_beneficiaries.label_tag}}<font color="red">*</font></label>
                    {{form.target_beneficiaries}}
                    </div>
                </div>
            </div>
        </div>



        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>{{form.cause_area.label_tag}}<font color="red">*</font></label>
                    {{form.cause_area}}
                    {% if form.cause_area.errors %}
                    <p style="color: red;">
                        Please Select.
                    </p>
                    {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label> Budget Type:<font color="red">*</font></label>
                    {{form.budget_type}}
                    {% if form.budget_type.errors %}
                    <p style="color: red;">
                        Please enter Budget Type.
                    </p>
                    {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>{{form.project_status.label_tag}}<font color="red">*</font></label>
                    {{form.project_status}}
                    {% if form.project_status.errors %}
                    <p style="color: red;">
                        Please Select.
                    </p>
                    {% endif %}
                    </div>
                </div>
            </div>
        </div>


                <div class="row">
            <!-- <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>Activities<font color="red">*</font></label>
                    <div class="input_fields_wrap">
                            <button class="add_field_button">Add More Activity</button>
                            {% if slug %}
                            {% for i in activity_view %}
                            <div><input class="form-control" value="{{i.name}}" type="text" name="activity[{{ forloop.counter }}]"><input class="form-control" type="number" value="{{i.activity_duration}}" name="duration[1]" placeholder="Duration" id="id_number">
                            {% endfor %}
                            {% else %}
                            <div><input class="form-control" placeholder="Enter Activity Name" value="{{i.name}}" type="text" name="activity[1]"><input class="form-control" type="number" value="{{i.activity_duration}}" name="duration[1]" placeholder="Enter Duration" id="id_number"></div>
                            {% endif %}
                    </div>
                </div>
            </div>
        </div></div> -->


        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                        <div class="input_fields_wrap">
                            <button class="add_field_button">Add More</button>
                            {% if obj %}
                            {% for i in location %}
                            <label>Location {{forloop.counter}}<font color="red">*</font></label>
                            <div class = "con_{{i.id}}">
                                
                                <select class="form-control" onchange="get_city(this.value,{{forloop.counter}});" name="state_{{forloop.counter}}" id="state_{{forloop.counter}}" required>
                                    
                                    <option disabled selected value> Select State </option>
                                    
                                    {% for j in state_list %}
                                    {% if j.id == i.location.parent.id %}
                                    
                                    <option value="{{i.location.parent.id}}" selected>{{i.location.parent.name}}</option>
                                    {% else %}
                                    <option value="{{j.id}}">{{j.name}}</option>
                                    {% endif %}
                                    {{i.location}}
                                    {% endfor %}
                                  </select>
                                  <select class="form-control" name="city1_{{forloop.counter}}" id="city1_{{forloop.counter}}" required>
                                    {% for j in city_list %}
                                    {% if j.id == i.location.id %}
                                    <option value="{{i.location.id}}" selected>{{i.location.name}}</option>
                                    {% else %}
                                    <option value="{{j.id}}">{{j.name}}</option>
                                    {% endif %}
                                    {{i.location}}
                                    {% endfor %}
                                  </select>

                                  <select class="form-control" name="type_{{forloop.counter}}" required>
                                    {% if not obj %}
                                    <option disabled selected value> Select Location Type </option>
                                    {% endif %}
                                    {% if i.program_type == 0 %}
                                    <option value="0" slected>Urban</option>
                                    {% else %}
                                    <option value="0">Urban</option>
                                    {% endif %}
                                    {% if i.program_type == 1 %}
                                    <option value="1" selected>Semi-Urban</option>
                                    {% else %}
                                    <option value="1">Semi-Urban</option>
                                    {% endif %}
                                    {% if i.program_type == 2 %}
                                    <option value="2" selected>Rural</option>
                                    {% else %}
                                    <option value="2">Rural</option>
                                    {% endif %}
                                  </select>
                            <input type="button" class="btnRemove" name="city1_{{forloop.counter}}" id="{{i.id}}" value="Remove"/>
                            </div>
                            <br>
                            {% endfor %}
                            {% else %}
                            <label>Location {{forloop.counter}}<font color="red">*</font></label>
                            <div>
                                <select class="form-control" onchange="get_city(this.value,1);" name="state_1" id="state" required>
                                    {% if not ids %}
                                    <option disabled selected value> Select State </option>
                                    {% endif %}
                                    {% for i in state_list %}
                                    {% if obj.location.parent.id == i.id %}
                                    <option value="{{i.id}}" selected>{{i.name}}</option>
                                    {% else %}
                                    <option value="{{i.id}}">{{i.name}}</option>
                                    {% endif %}
                                    {{i.location}}
                                    {% endfor %}
                                  </select>

                                  <select class="form-control" name="city1_1" id="city1_1" required>
                                    {% for i in city_list %}
                                    {% if obj.location.id == i.id %}
                                    <option value="{{i.id}}" selected>{{i.name}}</option>
                                    {% else %}
                                    <option value="{{i.id}}">{{i.name}}</option>
                                    {% endif %}
                                    {{i.location}}
                                    {% endfor %}
                                  </select>
                                  <select class="form-control" name="type_1" required>
                                    {% if not ids %}
                                    <option disabled selected value> Select Location Type </option>
                                    {% endif %}
                                    {% if obj.program_type == 0 %}
                                    <option value="0" slected>Urban</option>
                                    {% else %}
                                    <option value="0">Urban</option>
                                    {% endif %}
                                    {% if obj.program_type == 1 %}
                                    <option value="1" selected>Semi-Urban</option>
                                    {% else %}
                                    <option value="1">Semi-Urban</option>
                                    {% endif %}
                                    {% if obj.program_type == 2 %}
                                    <option value="2" selected>Rural</option>
                                    {% else %}
                                    <option value="2">Rural</option>
                                    {% endif %}
                                  </select>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

       <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>{{form.start_date.label_tag}}<font color="red">*</font></label>
                    {{form.start_date}}
                    <font color=#fc282f><b><span id="dateError1"></span></b></font>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>{{form.end_date.label_tag}}<font color="red">*</font></label>
                    {{form.end_date}}
                    <font color=#fc282f><b><span id="dateError"></span></b></font>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>Duration<font color="red">*</font></label>
                    {{form.duration}}
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                        <br>
                    <label>Funder<font color="red">*</font></label>
                    <select class="form-control" name="funder" id="funder"><option selected disabled>Select Funder</option>{% for i in funder_user %}<option {% if mapping_view.funder.id == i.id %}selected="selected" {% endif %} value="{{i.id}}" >{{i.organization}}</option>{% endfor %}</select>
                    
                    <p style="color: red;">
                        
                    <font color=#fc282f><span id="funder_error"></span></font>
                    </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <label>Implementation partner<font color="red">*</font></label>
                    <select class="form-control" name="implementation_partner" id="implementation_partner" required><option selected disabled>Select Implementation Partner</option>{% for i in partner %}<option {% if mapping_view.implementation_partner.id == i.id %}selected="selected" {% endif %} value="{{i.id}}" >{{i.organization}}</option>{% endfor %}</select>
                                <p style="color: red;">
                                    
                                <font color=#fc282f><span id="partner_error"></span></font>
                                </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 nopadding">
                <div class="col-md-12">
                    <div class="form-group">
                    <input style="width: 10px;" value="{{location.count}}" name="name_count" id="activity_count" type="hidden"/>
                    <input style="width: 0px;" value="" name="rem_id" id="rem_id" type="hidden"/>
                    <input style="width: 0px;" value="" name="city_var" id="city_var" type="hidden"/>

                        <input class="btn btn-primary" type="submit" value="Save" onclick="return ddlValidate();" />
                        <a class="btn btn-success" href="/project/list/">Back</button></a>
                    </div>
                </div>
            </div>
        </div>
                        
</div>
</form>
</div>
  </div>
</br>
<input type="hidden" name="loop_count" id="loop_count" value="{{activity_view.count}}">
  </div>
  </div>

<script src="http://code.jquery.com/jquery-migrate-1.0.0.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
<!-- <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> -->
<script src="https://rawgit.com/Pixabay/jQuery-tagEditor/master/jquery.caret.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://rawgit.com/Pixabay/jQuery-tagEditor/master/jquery.tag-editor.js"></script>
<link rel="stylesheet" href="https://rawgit.com/Pixabay/jQuery-tagEditor/master/jquery.tag-editor.css">


<script type="text/javascript">
var rem_id = []
var city_var = []
$('body').on('click','.btnRemove',function() {
    $(this).parent('div.con_'+ this.id +'').remove();
    city_var.push(this.name);
    rem_id.push(this.id);
    
    document.getElementById("rem_id").value = [rem_id];
    document.getElementById("city_var").value = [city_var];
});
document.getElementById("rem_id").value = [rem_id];
</script>
<script>
function get_city(value,index){
//$(document).ready(function(){
    //$('#state').on('change',function(){
        var countryID = value;
        var elem = document.getElementById("city");
        $.ajax({
            type:'GET',
            url:'/upload/city-list/',
            //dataType: "json",
            data : {'state_id':countryID},
            //data:'state_id='+countryID,
            success:function(data){
                var res = data.res;
                //$('#city').html(data);
                $('#city1_'+ index).find('option').remove().end();
                $('<option>', {value : "" }).html("---------").appendTo('#city1_'+ index);
                for (i=0;i<res.length;i++) {
                    $('<option>', {value : res[i].id }).html(res[i].name).appendTo('#city1_'+ index);
                }
            }

        });
        
    };
  </script>

<script>
  $( function() {
    $( "#id_start_date").datepicker({
    dateFormat: 'yy-mm-dd', changeMonth: true,changeYear: true,});
    $( "#id_end_date").datepicker();
  } );
  </script>

<script type="text/javascript">
$(document).ready(function() {
    //var loop_count = $('#loop_count').val()
    var max_fields      = 20; //maximum input boxes allowed
    var wrapper         = $(".input_fields_wrap"); //Fields wrapper
    var add_button      = $(".add_field_button"); //Add button ID
    
    {% if location %}
    var loop_count = {{location.count}}
    {% else %}
    var loop_count = 0
    {% endif %}
    var loop_count = Number(loop_count);
    if (loop_count > 0) {
        var x =Number(loop_count);
    } else {
        var x =Number(loop_count)+1
    }
    //var x =Number(loop_count)+1;
    $(add_button).click(function(e){ //on add input button click
        e.preventDefault();
        if(x < max_fields){ //max input box allowed
            x++; //text box increment
            $(wrapper).append('<br><label>Location '+ x +'<font color="red">*</font></label><div><select class="form-control" onchange="get_city(this.value,'+x +');" name="state_'+ x +'" id="state" required>{% if not ids %}<option disabled selected value> Select State </option>{% endif %}{% for i in state_list %}{% if obj.location.parent.id == i.id %}<option value="{{i.id}}" selected>{{i.name}}</option>{% else %}<option value="{{i.id}}">{{i.name}}</option>{% endif %}{{i.location}}{% endfor %}</select><select class="form-control" name="city1_'+ x +'" id="city1_'+ x +'" required>{% for i in city_list %}{% if obj.location.id == i.id %}<option value="{{i.id}}" selected>{{i.name}}</option>{% else %}<option value="{{i.id}}">{{i.name}}</option>{% endif %}{{i.location}}{% endfor %}</select><select class="form-control" name="type_'+ x +'" required>{% if not ids %}<option disabled selected value> Select Location Type </option>{% endif %}{% if obj.program_type == 0 %}<option value="0" slected>Urban</option>{% else %}<option value="0">Urban</option>{% endif %}{% if obj.program_type == 1 %}<option value="1" selected>Semi-Urban</option>{% else %}<option value="1">Semi-Urban</option>{% endif %}{% if obj.program_type == 2 %}<option value="2" selected>Rural</option>{% else %}<option value="2">Rural</option>{% endif %}</select></div>')

            // $(wrapper).append('<div><input type="text" name="location['+x+']"/><select><option value="volvo">Volvo</option><option value="saab">Saab</option><option value="opel">Opel</option><option value="audi">Audi</option></select><a href="#" class="remove_field">Remove</a></div>'); //add input box
        }
        document.getElementById("activity_count").value = x;

    });
    
    $(wrapper).on("click",".remove_field", function(e){ //user click on remove text
        e.preventDefault(); $(this).parent('div').remove(); x--;
    })
});
</script>


<style>
.error{color:red; min-width: 200px;}
</style>
  <div class="control-sidebar-bg"></div>

<script>
  $("#id_end_date").datepicker({
    dateFormat: 'yy-mm-dd',changeMonth: true,changeYear: true,
    onSelect: function(dateText, inst) {
        var start = new Date($('#id_start_date').val());
        var end = new Date($('#id_end_date').val());
        if (end <= start) {
            alert("'End date' should be greater than 'Start date'")
            document.getElementById('dateError').innerHTML="End date should be greater than Start date"
        };
        if (end > start) {
            document.getElementById('dateError').innerHTML=""
            document.getElementById('dateError1').innerHTML=""
        };

        var months = (end.getFullYear() - start.getFullYear()) * 12;
        months += end.getMonth() - start.getMonth();
        document.getElementById("id_duration").value = months +1;

    }

});
</script>

<script>
  $("#id_start_date").datepicker({
    dateFormat: 'yy-mm-dd',changeMonth: true,changeYear: true,
    
    })


</script>
<script>
function date_validate() {
    if ($('#id_start_date').val()>$('#id_end_date').val()){
        alert("'End date' should be greater than 'Start date'");
        return false;
        } else {
            return true;
        }
    }
</script>

<script>
function funder_val() {
    var e = document.getElementById("funder");
    var str = e.options[e.selectedIndex].value;

}
</script>

<script>
//Toggle
        
         $('.user-menu').on('click',function(){
          $('.dropdown-menu').slideToggle();
          
        });
         $(document).ready(function(e) {    
    /*Content Show/Hide */
    $('.hide-cont').hide();
    $('.close-cont').hide();
    $('.view-cont').click(function(){
        $('.hide-cont').slideDown(350);
        $('.close-cont').show();
        $('.view-cont').hide();
    });
    $('.close-cont').click(function(){
        $('.hide-cont').slideUp(350);
        $('.close-cont').hide();
        $('.view-cont').show();
    }); 
 });
    
</script>

<script type="text/javascript">
    $(document).ready(function(){
        $('select[multiple=multiple]').multiSelect()
        $("#prog_edit").validate({
            rules :
            {
                //id_project : {required:true},
                //program : {required:true},
                name : {required:true, maxlength: 300},
                total_budget : {required:true},
                no_of_beneficiaries : {required:true},
                target_beneficiaries : {required:true},
                cause_area : {required:true},
                duration : {required:true},
                funder: {required:true},
                implementation_partner: {required:true},
            },
            messages:
            {
                //id_project : {required : "<font color=#fc282f>Please enter the name</font>"},
                //program:{required:"<font color=#fc282f>Please select the program</font>"},
                name:{required:"<font color=#fc282f>Please enter name"},
                total_budget : {required:"<font color=#fc282f>Please enter Total Budget</font>"},
                no_of_beneficiaries:{required:"<font color=#fc282f>Please enter the no of beneficiaries</font>"},
                target_beneficiaries : {required : "<font color=#fc282f>Please enter primary beneficiary</font>"},
                cause_area : {required : "<font color=#fc282f>Please enter primary area of focus</font>"},
                duration : {required : "<font color=#fc282f>Please select project Start date and End date</font>"},
                funder : {required : "<font color=#fc282f>Please select funder</font>"},
                implementation_partner : {required : "<font color=#fc282f>Please select Implementation Partner</font>"},


            },
            highlight: function (element) {
                $(element).parent().addClass('error')
            },
            unhighlight: function (element) {
                $(element).parent().removeClass('error')
            },


        });
        
});
</script>
{% endblock %}
