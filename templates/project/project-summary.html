{% extends 'base.html' %}
{% load common_tags %}
{% load urs_tags %}
{% block section %}
<div class="clear"></div>
<!--Green pad starts-->
<section class="green-pad green-height">
	<div class="row">
	<div class="image-pad logo-shadow">
    	<a href="javascript:void(0);"><img class="border-pad" src="/static/img/logo-v.png" alt="" title="" ></a><a href="javascript:void(0);"><img src="img/logo-n.png" alt="" title="" ></a>
    </div>
    <div class="title-left">
    {% if obj %}
    <h4><a href = '/project/detail/?slug={{obj.slug}}'>{{obj.name}}</h4>
    {% else %}
    <h4><a href = '#'>Project Name</h4>
    {% endif %}
    <ul>
        {%if project_funders %}
    	<li><a href="">by {% if project_funders.funder.name %} {{project_funders.funder.name}} {% endif %}</a> </li>
        <li><a href="">NGO Partner: {% if project_funders.implementation_partner.name %} {{project_funders.implementation_partner.name}}{% endif %}</a></li>
        {% else %}
        <li><a href="">by Funder</a> </li>
        <li><a href="">NGO Partner: </a></li>
        {% endif %}
    </ul>    
    </div>
    <a id="myBtn1" class="green-link green-link1" href="javascript:void(0);"> <img src="/static/img/generator-report.png" alt=""> &nbsp;Generate Report</a>
     <div class="menu-bottom">
        <ul>
          <li><a class="active" href="/project/summary/?slug={{slug}}">Summary</a></li>
          <li><a href="/managing/listing/?slug={{slug}}">Task & Milestone</a></li>
          <li><a href="/manage/project/budget/view/?slug={{slug}}">Budget</a></li>
          <li><a href="/upload/list/?slug={{slug}}&model=Project">Files</a></li>
          <li><a href="/project/tranche/list/?slug={{slug}}">Tranches</a></li>
        </ul>
     </div>
    </div>
</section>
<!--Green pad Ends-->
<!--Content part starts-->
{% endblock %}

{% block content %}
<section class="content-part">
	<div class="row">
    <div class="white-box timeline-white">
    	<h2>Timeline Progress</h2>
    	    {% get_user_permission request as user_obj %}
        {% if user_obj.is_admin_user == True or user_obj.organization_type == 2 %}
    	<a class="link-pad" href="/upload/images/?slug={{obj.slug}}">Upload Images</a>
    	{% endif %}
        <div class="clear"></div>
        <div id="scrollbar1">
                <div class="viewport">
                     <div class="overview">
                       <div id="time-line-pad">
            <div class="time-line">
                <div class="time-line-bdr"></div>
                            
                {% if timeline %}
                    {% for i in timeline %}
                    
                        <ul>
                        {% if not forloop.counter|divisibleby:2 %}
                        <li class="event-up">
                            &nbsp;
                            <div class="event-img">
                                <img src="{{image_url}}{{i.attachment_file.url}}" width="162" height="112" alt="">
                                <p>{% if i.description %} {{i.description}} {% endif %}</p>
                            </div>
                            <div class="event-circle"></div>
                            <div class="event-date">{{i.date | date:"d"}} <span>{{i.date | date:"M"}}</span></div>
                        </li>
                        {% else %}
                        <li class="event-down">
                         &nbsp;
                            <div class="event-img">
                                <p>{{i.description}}</p>
                                <img src="{{image_url}}{{i.attachment_file.url}}" width="162" height="112" alt="">
                            </div>
                            <div class="event-circle"></div>
                            <div class="event-date">{{i.date | date:"d"}} <span>{{i.date | date:"M"}}</span></div>
                        </li>
                        {% endif %}
                        </ul>
                    {% endfor %}
                {% endif %}

            </div>
           </div>
                    </div>
                </div>
                <div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>
       </div>
    </div>
    <div class="clear"></div>
	<div class="content-top margin-top">
      <div class="select-area">
      	<label>See Data as </label>

        <div class="dropdown user select-down select-width">
            <a href="javascript:void(0);" class="dropdown-toggle" >
              <p>By Year</p>
              <i class="fa fa-angle-down"></i>
            </a>
            <ul class="dropdown-menu1" style="display:none;">

              <li class="user-header">
                <input class="check-box" type="checkbox" id="one" />
                <label for="one"><span><span></span></span> 2015</label>
              </li>
              <li>
                <input class="check-box" type="checkbox" id="two" />
                <label for="two"><span><span></span></span> 2016</label>
              </li>
              <li>
                <input class="check-box" type="checkbox" id="three" />
                <label for="three"><span><span></span></span> 2017</label>
              </li>
              <li>
                <input class="check-box" type="checkbox" id="four" />
                <label for="four"><span><span></span></span> 2017</label>
              </li>

            </ul>
          </div>
          <div class="small-select">
        <select name="lang" class="select_box ">
            <option>2016</option>
            <option>2017</option>
        </select>
        </div>

        <!--<select name="lang" class="select_box ">
            <option>Select Quarters</option>
            <option>Quarter1</option>
            <option>Quarter2</option>
        </select>-->
         </div>
    </div>
    <div class="clear"></div>
    <div class="white-box white-pad">
    	<div class="key-program">
        <h2>Key Program Info</h2>
        {% get_user_permission request as user_obj %}
        {% if user_obj.is_admin_user == True or user_obj.organization_type == 2  and user_obj.owner == True %}
        {% if parameter_count > 4 %}
        <a class="link-pad" href="#">Upload Parameters</a>
        {% else %}
        <a class="link-pad" href="/project/parameter/manage/?slug={{slug}}&key=2">Upload Parameters</a>
        {% endif %}
        {% endif %}
        </div>
        <ul>
            {% for i in parent_paremeter %}
        	<li>
            	<h3>{{i.keyparameter.name}}</h3>

                {% if i.keyparameter.parameter_type == 'CUR' %}
                 <img class="key-image" src="/static/img/budget-icon.png" alt="">
                 {% else %}
                 <img class="key-image" src="/static/img/key-icon2.png" alt="">
                 {% endif %}
                <h4 class="title-pad">{{i.parameter_value}}</h4>
            </li>
            {% endfor %}
            {% if master_obj_pip %}
            <li>
            	<h3>{{chart_name_pip}}</h3>
                <div class="right-budget beni-dist">
                {% for  lol in  master_pin %}
                 <div id="{{lol}}" style="width: 100%;float: left;"></div>
                {% endfor %}
            </div>
            </li>
            {% endif %}
            <!-- <li>
            	<h3>Total Budget</h3>
                 <img class="key-image" src="/static/img/budget-icon.png" alt="">
                <h4 class="title-pad">2.3cr</h4>
            </li> -->
            {% if master_obj_pin %}
             <li>
            	<h3>{{chart_name_pin}}</h3>
                <div class="right-budget beni-dist beni-dist1">
                {% for rofl in master_pip %}
                <div id="{{rofl}}" style="width: 100%;float: left;"></div>
                {% endfor %}
            </div>
            </li>
            {% endif %}
        </ul>
    </div>
    <div class="white-box">
    	<div class="left-white-pad">
        	<h3>Total Task Completed</h3>
            <div class="img-left">
            <img src="/static/img/board-img.png" alt="">
            </div>
            <div class="budget-value-right">
            <div class="budget-value">
                {% if tasks %}
                  <div class="budget-left">{{tasks.completed_tasks}} tasks</div>
                  <div class="budget-right">{{tasks.percent}}%</div>
              </div>
              <h5>of {{tasks.total_tasks}} tasks <br>
under {{tasks.total_milestones}} Milestones</h5>
                {% else %}
                    <div class="budget-left">0 tasks</div>
                  <div class="budget-right">0%</div>
              </div>
              <h5>of 0 tasks <br>
under 0 Milestones</h5>
                {% endif %}
		</div>
        </div>
        <div class="right-white-pad">
        	<h3>Total Budget</h3>
            <div class="budget-pad">
            {% if budget %}
              <p><span class="green-d-circle"></span> Utilized</p>
              <div class="budget-value">
                  <div class="budget-left">{{budget.utilized}}cr </div>
                  <div class="budget-right">{{budget.utilized_percent}}%</div>
              </div>
              <p><span class="green-circle"></span> Disbursed</p>
              <div class="budget-value">
                  <div class="budget-left">{{budget.disbursed}}cr</div>
                  <div class="budget-right">{{budget.disbursed_percent}}%</div>
              </div>
              <p><span class="yellow-circle"></span> Total</p>
              <div class="budget-value budget-border">
                  <div class="budget-left">{{budget.total}}cr</div>
                  <div class="budget-right">{{budget.total_percent}}%</div>
              </div>
            {% endif %}
          </div>
          <div class="img-right">
            <div id = "total_budget" style="width:100%;float:left;"></div>
          </div>
        </div>
    </div>
    <div class="wip-image">
    	<img src="/static/img/wip-img.jpg" alt="">
    </div>
    <div class="white-box-left">
    <div class="table-responsive">
    <table class="table-resp" cellpadding="0" cellspacing="0" border="0">
      <thead>
      <tr>
        <th style="width:28%;">Users</th>
        <th style="width:19%;">Organization</th>
        <th style="width:26%;">Designation</th>
        <th style="width:19%;">PMU Role</th>
        <th style="width:10%;">&nbsp;</th>
      </tr>
      </thead>
      <tbody>
      {% if projectuserlist %}
      {% for i in projectuserlist %}
      <tr>
            <td style="width:28%;"><img src="/static/img/user-img.png" class="user-image" alt="User Image">{{i.user.name}}</a></td>
            <td style="width:19%;">{{i.user.organization}}</td>
            <td style="width:26%;">{% if i.user.designation %}{{i.user.designation}} {% else %} {% endif %}</td>
            <td style="width:19%;">{{i.role.name}}
                {% get_user_permission request as user_obj %}
        {% if user_obj.is_admin_user == True or user_obj.organization_type == 2 %}
            <td style="width:10%;"><a class="btn btn-primary" href="/manage/project/role/edit/?objid={{i.id}}&slug={{obj.slug}}&key=summary">Edit</a></td>{% endif %}
      </tr>
      {% endfor %}
      {% else %}
        <h5>Users not tagged</h5>
      {% endif %}

      </tbody>
  </table>
	</table>
    </div>
        {% get_user_permission request as user_obj %}
        {% if user_obj.is_admin_user == True or user_obj.organization_type == 2  and user_obj.owner == True %}
    <a href="/manage/project/role/add/?slug={{obj.slug}}&key=summary" class="link-pad">Add User</a>
    {% endif %}
    </div>
    <div class="white-box-right">
    	<h2>Recent Updates</h2>
         <div id="boxscroll" class="updates-scroll ">
        <p><span>Today</span> - {% now "jS F Y" %}</p>
            <ul>
         {% if updates_list %}
             {% for obj in updates_list %}
                    {% get_details obj as update %}
                        {% for i in update %}
                           {{i | safe}}
                        {% endfor %}
            </ul>
                {% endfor %}
         {% else %}
            <li><span>No updates </span></li>
         {% endif %}
        </ul>
        </div>
    </div>
    </div>
</section>
<!--Content part Ends-->

</div>

{% endblock %}

{% block script %}
<!-- jQuery (necessary for JavaScript plugins) -->
<!--<script type="text/javascript" src="/static/js/jquery.selectbox-0.2.js"></script>-->
<!--<script type="text/javascript" src="/static/js/ddsmoothmenu.js"></script>-->
<!--<script type="text/javascript" src="/static/js/jquery.mmenu.min.all.js"></script>-->
<!--<script type="text/javascript" src="/static/js/common.js" /></script>-->
<!--<script type="text/javascript" src="js/jquery.scrollbox.js"></script>-->
<script src="/static/js/owl.carousel.js"></script>
<script type="text/javascript" src="/static/js/jquery.tinyscrollbar.js"></script>
<script src="/static/js/jquery.nicescroll.min.js"></script>
<script src="/static/js/easyResponsiveTabs.js" type="text/javascript"></script>




<script>
//Toggle

	$('.user-menu').on('click',function(){
		$('.dropdown-menu').slideDown(350);

	});
	$('.select-down').on('click',function(){
        $('.dropdown-menu1').slideDown(350);

    });

	$(document).ready(function(e) {
		/*Content Show/Hide */
		$('.hide-cont').hide();
		$('.close-cont').hide();
		$('.view-cont').click(function(){
			$('.hide-cont').slideDown(350);
			$('.close-cont').show();
			$('.view-cont').hide();
		});
		$('.close-cont').click(function(){
			$('.hide-cont').slideUp(350);
			$('.close-cont').hide();
			$('.view-cont').show();
		});
		$(document).trigger( "click" );
	});

	$(document).click(function(){

		$('.user-menu, .select-down').click(function(event){
			event.stopPropagation();
		});

		$('.dropdown-menu, .dropdown-menu1').slideUp(350);

	});
</script>


    <script>
  $(document).ready(function() {
    $("#boxscroll1").niceScroll({cursorborder:"",cursorcolor:"#949494",boxzoom:true}); // First scrollable DIV
  });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#horizontalTab').easyResponsiveTabs({
            type: 'default', //Types: default, vertical, accordion
            width: 'auto', //auto or any width like 600px
            fit: true,   // 100% fit in a container
            closed: 'accordion', // Start closed if in accordion view
            activate: function(event) { // Callback function if tab is switched
                var $tab = $(this);
                var $info = $('#tabInfo');
                var $name = $('span', $info);

                $name.text($tab.text());

                $info.show();
            }
        });
		});
</script>
<script>
  $(document).ready(function() {


    $("#boxscroll, .table-resp tbody").niceScroll({cursorborder:"",cursorcolor:"#949494",boxzoom:true}); // First scrollable DIV

	var li_Count = $('.time-line li').length;
	$(".time-line").css('width', 200*li_Count);
  });

	$(document).ready(function()
	{
		  $("#scrollbar1").tinyscrollbar({ axis: "x"});

	});
</script>
<script>
$(document).ready(function(){
	var owl = $('#img-carousel');
	owl.owlCarousel({
		goToFirstSpeed :1500,
		items:4,
		margin:25,
		loop:true,
		autoplay:true,
		singleItem: true,
		autoplayTimeout:4000,
		autoplayHoverPause:true,
		responsive: {
			0:{ items:1 },
			479:{ items:2 },
			639:{ items:2 },
			768:{ items:4 },
			1024:{ items:4 },
			1280:{ items:4 }
		},
		nav : true,
		dots : false
	  });
	var owl = $('#con-carousel');
	owl.owlCarousel({
		goToFirstSpeed :1000,
		items:6,
		margin:25,
		loop:true,
		autoplay:true,
		autoplayTimeout:4000,
		autoplayHoverPause:true,
		responsive: {
			0:{ items:3 },
			639:{ items:4 },
			768:{ items:5 },
			1024:{ items:5 },
			1280:{ items:6 }
		},
		nav : true,
		dots : false
	  });


	});
</script>
<script src="/static/js/jquery.simplePopup.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function(){
    $('#myBtn').click(function(){
	$('#pop1').simplePopup();
    });
});

	$(document).ready(function(){
    $('#myBtn1').click(function(){
	$('#pop3').simplePopup();
    });
});

</script>

<!---datepicker script-->
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
<script>
	$(function() {
	$( ".datepicker" ).datepicker({
	showOn: "button",
	buttonImage: "/static/img/calender-icon.png",
	buttonImageOnly: true
	});
	});
</script>

<script src="/static/code/highcharts.js"></script>
<script src="/static/code/highcharts-more.js"></script>

<script src="/static/code/modules/solid-gauge.js"></script>
<script type="text/javascript">
    var new_data_pin = 0;
    var new_data_pip = 0;
</script>
<!--/* Pie Chat Number */-->
<script type="text/javascript">
{% for pin in master_sh.PIN %}
//alert(pin);
var data1 = {{pin | safe}};
var values = "Batch_size_" + (new_data_pin).toString()
new_data_pin++;
Highcharts.chart(values, {
   chart:{type:'pie', backgroundColor: null,height:288},
            credits:{enabled: false},
            colors:[
                '#5485BC', '#AA8C30', '#5C9384', '#981A37', '#FCB319',     '#86A033', '#614931', '#00526F', '#594266', '#cb6828', '#aaaaab', '#a89375'
                ],
            title:{text: null},
            tooltip:{
                enabled: true,
                animation: true
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    animation: true,
                    cursor: 'pointer',
                    showInLegend: true,
                    dataLabels: {
                        enabled: false,
                        formatter: function() {
                            return this.percentage.toFixed(2) + '%';
                        }
                    }
                }
            },
            legend: {
                enabled: true,
                layout: 'horizontal',
                align: 'center',
                width: 250,
                verticalAlign: 'bottom',
                borderWidth: 0,
                useHTML: true,

                margin: 12


            },
            series: [{
                type: 'pie',
                dataLabels:{

                },
                data: data1

            }]
        });
{% endfor %}
</script>

<!--/* Pie Chart Percentage */-->
<script type="text/javascript">
{% for pip in master_sh.PIP %}
var data2 = {{pip | safe}};
var values = "Beneficary_distribution_" + (new_data_pip).toString()
new_data_pip++;
Highcharts.chart(values, {
   chart:{type:'pie', backgroundColor: null,height:288},
            credits:{enabled: false},
            colors:[
                '#5485BC', '#AA8C30', '#5C9384', '#981A37', '#FCB319',     '#86A033', '#614931', '#00526F', '#594266', '#cb6828', '#aaaaab', '#a89375'
                ],
            title:{text: null},
            tooltip:{
                enabled: true,
                animation: true
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    animation: true,
                    cursor: 'pointer',
                    showInLegend: true,
                    dataLabels: {
                        enabled: false,
                        formatter: function() {
                            return this.percentage.toFixed(2) + '%';
                        }
                    }
                }
            },
            legend: {
                enabled: true,
                layout: 'horizontal',
                align: 'center',
                width: 250,
                verticalAlign: 'bottom',
                borderWidth: 0,
                useHTML: true,

                margin: 12


            },
            series: [{
                type: 'pie',
                dataLabels:{

                },
                data: data2

            }]
        });
{% endfor %}
</script>

<script>
var data = {{budget|safe}}
console.log(data);
var utilized = data.utilized_percent
var disbursed = data.disbursed_percent
var total = 100 - (utilized + disbursed)
var gaugeOptions = {

    chart: {
        height:250,
         plotBackgroundColor: null,
            plotBackgroundImage: null,
            plotBorderWidth: 0,
            plotShadow: false

    },

    title: null,

      pane: {
            center: ['50%', '50%'],
            size: '100%',
            startAngle: -90,
            endAngle: 90,
            background: {
                borderWidth: 1,
                backgroundColor: '#D0C173',
                borderColor: '#D0C173',
                innerRadius: '60%',
                outerRadius: '100%',
                shape: 'arc'
            }
        },


    tooltip: {
        enabled: false
    },

    // the value axis
    yAxis: {
        //     stops: [
        //     [0.1, '#D0C173'], // green
        //     [0.5, '#34837C'] // yellow


        // ],
        lineWidth: 0,
        minorTickInterval: null,
        tickAmount: 0,
        title: {
            y: -70
        },
        labels: {
            enabled: false
        },

   },


    // plotOptions: {
    //    gauge: {
    //             pivot: {
    //                 radius: 0

    //             }, dial: {
    //                 backgroundColor:'#7A4F59',
    //                 borderColor: "#DAC7CC",
    //                 radius: '100%',
    //                 baseWidth: 2,
    //                    baseLength: '100%',
    //                     baseWidth: 2,
    //                     rearLength: '0%',
    //                     borderWidth: 0
    //             }
    //         }
    // }

     plotOptions: {
            pie: {
                dataLabels: {
                    enabled: false
                },
                startAngle: -90,
                endAngle: 90,
                center: ['50%', '50%']
            },
            gauge: {
                dataLabels: {
                    enabled: false
                },
                pivot: {
                    radius: 0

                }
                ,
                dial: {
                    backgroundColor:'#7A4F59',
                    borderColor: "#7A4F59",
                    radius: '105%',
                    baseWidth: 2,
                       baseLength: '100%',
                        baseWidth: 2,
                        rearLength: '0%',
                       // borderWidth: 0
                }
            }
        },

};

// The speed gauge
var chartSpeed = Highcharts.chart('total_budget', Highcharts.merge(gaugeOptions, {

    yAxis: {
        min: 0,
        max: 100,
        title: {
            text: ''
        }
    },

    credits: {
        enabled: false
    },

      series: [
      {
            type: 'pie',
             size: '100%',

            innerSize: '76%',
            data: [

                {y:utilized,name:'Utilized',color:'#006861',borderColor: "#006861"},
                {y:disbursed,name:'Disbursed',color:'#169776',borderColor: "#169776"},
                {y:total,name:'Total',color:'#D0C173',borderColor: "#D0C173"}


            ]
        },

        {
            type: 'gauge',
            data: [0],

        }
    ],
        dataLabels: {
               enabled: false
        }


}));

// Bring life to the dials
setInterval(function () {
    // Speed
    var point,
        point1,
        newVal,
        inc;

    if (chartSpeed) {
        point = chartSpeed.series[0].points[0];

        point1 = chartSpeed.series[0].points[1];

        $.each(chartSpeed.series, function(i, item){
            if(item.type == 'gauge'){

               item.setData([["none",point1.y+point.y]], true);

            }
        });

        //console.log(chartSpeed.series[1].points);



        // chartSpeed.yAxis[0].removePlotBand('plot-band-1');
        //     chartSpeed.yAxis[0].addPlotBand({
        //         from: 0,
        //         to: point.y,
        //         color: '#2F9974',
        //         thickness: '40%',
        //         id: 'plot-band-1'
        //     });



        // point.update(point.y);
    }

}, 800);

</script>
<style type="text/css">
 #total_budget .highcharts-container {
       border-bottom: 1px solid;
       height: 120px !important;
   }
    .highcharts-background {
   fill: none
}
</style>
{% endblock %}
